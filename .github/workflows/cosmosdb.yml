
name: mystorekeeper infrastructure
on:
  push:
    branches:
      - dev
      - stage
      - prod
    paths:
      - "cosmosdb/**"

  workflow_dispatch:
  
jobs:

  # Run job when pushed to development environment
  DEV:
    if: ${{ github.ref == 'refs/heads/dev' }}
    environment: DEV
    name: Development environment
    runs-on: ubuntu-22.04
    steps:
      - id: A
        name: checkout repository
        uses: actions/checkout@v3
      - id: B
        name: 'Az CLI login'
        uses: azure/login@v1
        with:
            client-id: ${{ secrets.AZURE_CLIENT_ID }}
            tenant-id: ${{ secrets.AZURE_TENANT_ID }}
            subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      - id: C
        name: Azure CLI script
        uses: azure/CLI@v1
        with:
          azcliversion: 2.30.0
          inlineScript: |
            az group create \
            -n ${{ vars.RESOURCE_GROUP_NAME }} \
            -l ${{ vars.LOCATION }}


  # Run job when pushed to staging environment
  STAGE:
    if: ${{ github.ref == 'refs/heads/stage' }}
    environment: STAGE
    name: Staging environment
    runs-on: ubuntu-22.04
    steps:
      - id: A
        name: checkout repository
        uses: actions/checkout@v3

  # Run job when pushed to production environment
  PROD:
    if: ${{ github.ref == 'refs/heads/prod' }}
    environment: PROD
    name: Production environment
    runs-on: ubuntu-22.04
    steps:
      - id: A
        name: checkout repository
        uses: actions/checkout@v3